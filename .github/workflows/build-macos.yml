@'
name: Build macOS Application

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        
        # 检查是否有 requirements.txt
        if [ -f "requirements.txt" ]; then
          pip install -r requirements.txt
        fi
        
    - name: Check project structure
      run: |
        echo "项目结构:"
        find . -type f -name "*.py" | head -10
        echo ""
        echo "src 目录:"
        ls -la src/ 2>/dev/null || echo "src 目录不存在"
        
    - name: Simple PyInstaller test
      run: |
        # 首先检查主文件是否存在
        if [ ! -f "src/bmr_mac_gui.py" ]; then
          echo "❌ 主文件不存在: src/bmr_mac_gui.py"
          
          # 尝试寻找其他 Python 文件
          MAIN_FILE=$(find . -name "*.py" -type f | head -1)
          if [ -z "$MAIN_FILE" ]; then
            echo "创建测试文件..."
            mkdir -p src
            echo "print(\"Hello BMR Calculator\")" > src/bmr_mac_gui.py
            MAIN_FILE="src/bmr_mac_gui.py"
          fi
          echo "使用文件: $MAIN_FILE"
        else
          MAIN_FILE="src/bmr_mac_gui.py"
        fi
        
        # 尝试构建
        echo "构建文件: $MAIN_FILE"
        pyinstaller --onefile --name "BMR_Calculator" "$MAIN_FILE" || {
          echo "PyInstaller 失败，尝试更简单的构建..."
          pyinstaller --onefile "$MAIN_FILE"
        }
        
    - name: Check build result
      run: |
        echo "构建结果:"
        ls -la dist/ 2>/dev/null || echo "dist 目录不存在"
        
    - name: Upload artifact
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: BMR-Calculator
        path: dist/
'@ | Out-File -FilePath .github/workflows/build.yml -Encoding UTF8 -Force